<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="supplyMapper">

<resultMap type="SupplyDto" id="selectSupplyResultMap">
	<result column="SUP_NO" property="supNo" />
	<result column="SUP_CATEGORY" property="supCategory" />
	<result column="SUP_NAME" property="supName" />
	<result column="SUP_STATUS" property="supStatus" />
	<result column="SUP_DATE" property="supDt" />
	<result column="SUP_MODEL" property="supModel" />
	<result column="SUP_REPAIR" property="supRepair" />
	<result column="SUP_REPAIR_DETAIL" property="supRepairDetail" />
	<result column="SUP_TYPE" property="supType" />
	<result column="LEFTSUPPLY" property="leftSupply" />
	<result column="REPAIRSUPPLY" property="repairSupply" />
	<result column="WORKSUPPLY" property="workSupply" />
</resultMap>


<!-- 비품 전체 목록 조회하기 -->
<select id="selectSupplyList" resultMap="selectSupplyResultMap">
	SELECT 
		     SUP_CATEGORY, 
		     SUP_TYPE,
		     COUNT(CASE WHEN SUP_STATUS = 'N' THEN 1 END) AS LEFTSUPPLY,
		     COUNT(CASE WHEN SUP_REPAIR = 'Y' THEN 1 END) AS REPAIRSUPPLY,
		     COUNT(CASE WHEN SUP_REPAIR = 'Y' AND SUP_STATUS != 'N' THEN 1 END) AS WORKSUPPLY
		FROM 
		     SUPPLIES
	  <if test="supCategory != '전체'">
	 WHERE SUP_CATEGORY = #{supCategory}
	 	</if>
	 GROUP BY 
		     SUP_CATEGORY, 
		     SUP_TYPE
	 ORDER BY 
		     SUP_CATEGORY, 
		     SUP_TYPE
</select>


<select id="countSupply" resultType="_int">
	SELECT count(*)
		FROM 
		     SUPPLIES
   <if test="supCategory != '전체'">
      where sup_category = #{supCategory}
   </if>
</select>


</mapper>
